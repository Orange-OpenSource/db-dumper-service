#!/usr/bin/env bash
set -e
file="$2"
centmb="$1"
if [ $# -ne 2 ];
    then echo "Usage: $0 [file_size_in_bytes] [file_name]"
    exit 1
fi
cat <<EOT > "$file"
DROP TABLE IF EXISTS fake_table;
CREATE TABLE fake_table
(
    value VARCHAR(8)
);
EOT
file_dir=$(dirname "${file}")
size_beginning=`ls -la "file_dir" | grep "$file" | awk '{ print $5 }'`
head -c 5 /dev/urandom | base64 | fold -w8 | sed "s/\(.*\)/INSERT INTO fake_table VALUES \('\1'\);/" | tr -d '\n' >> "$file"
size=`ls -la | grep "$file" | awk '{ print $5 }'`
size=$(($size - $size_beginning))
iter=$(($centmb / $size))
finalbytes=$((5 * $iter))
head -c $finalbytes /dev/urandom | base64 | fold -w8 | sed "s/\(.*\)/INSERT INTO fake_table VALUES \('\1'\);/" | tr -d '\n' >> "$file"
head -c 5 /dev/urandom | base64 | fold -w8 | sed "s/\(.*\)/INSERT INTO fake_table VALUES \('\1'\);/" | tr -d '\n' >> "$file"